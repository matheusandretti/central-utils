<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <title>Monitor Simples Nacional</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>

<body class="app-body nfe-body">
  <div class="nfe-layout">
    <!-- SIDEBAR -->
    <aside class="nfe-sidebar">
      <div class="nfe-sidebar-top">
        <div class="nfe-sidebar-logo">
          <span class="logo-circle">WL</span>
          <span class="logo-text">Portal</span>
        </div>

        <button class="nfe-sidebar-toggle" id="sidebarToggle" type="button">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>

      <nav class="nfe-sidebar-menu" id="sidebarMenu"></nav>

    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="nfe-main">
      <!-- Cabeçalho / Breadcrumb -->
      <header class="nfe-header">
        <div class="nfe-breadcrumb">Portal / Fiscal / Declaração SN</div>
        <h1>Declaração Mensal – Simples Nacional</h1>
        <p>Cadastre as empresas, selecione o período e envie declarações ou consulte os recibos via Integra Contador.
        </p>
      </header>

      <!-- Linha principal: filtros + resumo -->
      <section class="nfe-row">
        <!-- CARD: Empresas, período e ações -->
        <div class="nfe-card nfe-card-upload">
          <h2>Empresas e período de apuração</h2>
          <p class="nfe-card-subtitle">
            Selecione o período de apuração, escolha as empresas e envie declarações ou consulte os recibos já
            transmitidos.
          </p>

          <!-- Período: mês + ano -->
          <div class="nfe-section">
            <h3>Período de apuração</h3>
            <div class="nfe-upload-form">
              <label class="nfe-input-file-label">
                <span>Mês:</span>
                <select id="paMes" class="sn-select" required>
                  <option value="">Selecione</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select>
              </label>

              <label class="nfe-input-file-label">
                <span>Ano:</span>
                <select id="paAno" class="sn-select" required>
                  <!-- preenchido via JS -->
                </select>
              </label>
            </div>
          </div>

          <hr class="nfe-divider" />

          <!-- Empresas: dropdown com checkboxes + botão de cadastro -->
          <div class="nfe-section">
            <div class="nfe-upload-form">
              <div class="nfe-input-file-label">
                <div class="nfe-input-header-row">
                  <span>Empresas:</span>
                  <button type="button" id="openCompanyModal" class="btn btn-secondary btn-icon">+</button>
                </div>

                <!-- Dropdown com checkboxes -->
                <div class="multi-select" id="companiesMultiSelect">
                  <div class="multi-select-control" id="companiesDropdown">
                    <span id="companiesDropdownLabel">Selecione as empresas</span>
                    <span class="multi-select-arrow">▼</span>
                  </div>
                  <div class="multi-select-options" id="companiesOptions">
                    <!-- opções preenchidas via JS -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <hr class="nfe-divider" />

          <!-- Ações -->
          <div class="nfe-section">
            <div class="nfe-upload-form">
              <button type="button" id="btnEnviarDecl" class="btn btn-primary">
                Enviar declarações
              </button>

              <button type="button" id="btnConsultarRecibos" class="btn btn-secondary">
                Consultar últimos recibos
              </button>
            </div>

            <div id="snStatus" class="nfe-upload-message"></div>
          </div>
        </div>

        <!-- CARD RESUMO DE CONSUMO -->
        <div class="nfe-card nfe-card-ext">
          <h2>Resumo do consumo</h2>
          <p class="nfe-card-subtitle">
            Acompanhe as operações realizadas (declarações + consultas) e o valor total estimado.
          </p>
          <p id="consumoInfo">Nenhuma operação realizada.</p>
        </div>
      </section>

      <!-- Resultados -->
      <section class="nfe-row">
        <div class="nfe-card nfe-card-upload">
          <h2>Resultado do processamento</h2>
          <div class="sn-actions-row">
            <button type="button" id="btnDownloadTodosRecibos" class="btn btn-secondary" disabled>
              Baixar todos os recibos
            </button>
          </div>
          <p class="nfe-card-subtitle">
            Veja o status de cada empresa para o período selecionado, incluindo o link do recibo quando disponível.
          </p>
          <div class="nfe-table-wrapper">
            <table id="snResultsTable" class="nfe-table">
              <thead>
                <tr>
                  <th>CNPJ</th>
                  <th>Razão Social</th>
                  <th>Operação</th>
                  <th>Status</th>
                  <th>Mensagens</th>
                  <th>Recibo</th>
                </tr>
              </thead>
              <tbody>
                <!-- preenchido via JS -->
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- MODAL DE CADASTRO DE EMPRESA -->
  <div id="companyModal" class="modal hidden">
    <div class="modal-overlay" id="companyModalOverlay"></div>
    <div class="modal-content">
      <h3>Cadastrar empresa</h3>
      <form id="snCompanyForm">
        <label class="nfe-input-file-label">
          <span>CNPJ:</span>
          <input type="text" id="cadCnpj" maxlength="14" placeholder="00000000000100" required />
        </label>

        <label class="nfe-input-file-label">
          <span>Razão Social:</span>
          <input type="text" id="cadRazao" maxlength="100" placeholder="Razão Social da empresa" required />
        </label>

        <div class="modal-actions">
          <button type="button" id="closeCompanyModal" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
      <div id="snCompanyMessage" class="nfe-upload-message"></div>
    </div>
  </div>

  <script src="/js/sidebar.js"></script>
  <script src="/js/sn.js"></script>

</body>

</html>