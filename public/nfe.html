<!-- public/nfe.html -->
<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <title>Monitor de NF-e - Robô</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="/socket.io/socket.io.js"></script>
</head>

<body class="app-body nfe-body">
  <div class="nfe-layout">
    <!-- SIDEBAR -->
    <aside class="nfe-sidebar">
      <div class="nfe-sidebar-top">
        <div class="nfe-sidebar-logo">
          <span class="logo-circle">WL</span>
          <span class="logo-text">Portal</span>
        </div>

        <button class="nfe-sidebar-toggle" id="sidebarToggle" type="button">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>

      <nav class="nfe-sidebar-menu" id="sidebarMenu"></nav>

    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="nfe-main">
      <!-- Cabeçalho / Breadcrumb -->
      <header class="nfe-header">
        <div class="nfe-breadcrumb">Portal / Fiscal / Consulta NF-e</div>
        <h1>Monitor de NF-e</h1>
        <p>Automatize a consulta de notas no Portal Nacional usando o NFe Helper.</p>
      </header>

      <!-- Linha com Upload + Extensão -->
      <section class="nfe-row">
        <!-- CARD UPLOAD -->
        <div class="nfe-card nfe-card-upload">
          <h2>Upload de arquivo com chaves</h2>
          <p class="nfe-card-subtitle">
            Envie um arquivo de texto, planilha ou lista com as chaves de acesso que deseja consultar.
          </p>

          <form id="uploadForm" class="nfe-upload-form">
            <label for="fileInput" class="nfe-input-file-label">
              <span>Selecionar arquivo...</span>
              <input type="file" name="file" id="fileInput" required />
            </label>

            <button type="submit" id="btnUpload" class="btn btn-primary">
              Enviar arquivo
            </button>
          </form>

          <div id="uploadMessage" class="nfe-upload-message"></div>
        </div>

        <!-- CARD EXTENSÃO / PORTAL -->
        <div class="nfe-card nfe-card-ext">
          <h2>Extensão &amp; Portal Nacional NF-e</h2>
          <p class="nfe-card-subtitle">
            Para usar o robô, instale e mantenha ativa a extensão <strong>Consulta NFe Helper</strong>.
          </p>

          <button id="btnOpenPortal" class="btn btn-secondary" disabled>
            Iniciar consultas no Portal NF-e
          </button>

          <div id="extStatus" class="nfe-ext-status"></div>
        </div>
      </section>

      <!-- Resumo da fila -->
      <section class="nfe-card nfe-card-dashboard">
        <div class="nfe-card-header">
          <h2>Resumo da fila</h2>
        </div>

        <div class="nfe-metrics">
          <div class="nfe-metric nfe-metric-pending">
            <span class="label">Pendentes</span>
            <strong id="cardPending">0</strong>
          </div>
          <div class="nfe-metric nfe-metric-processing">
            <span class="label">Processando</span>
            <strong id="cardProcessing">0</strong>
          </div>
          <div class="nfe-metric nfe-metric-captcha">
            <span class="label">Aguardando Captcha</span>
            <strong id="cardWaitingCaptcha">0</strong>
          </div>
          <div class="nfe-metric nfe-metric-done">
            <span class="label">Concluídos</span>
            <strong id="cardDone">0</strong>
          </div>
          <div class="nfe-metric nfe-metric-error">
            <span class="label">Erros</span>
            <strong id="cardError">0</strong>
          </div>
        </div>
      </section>

      <!-- Tabela da fila -->
      <section class="nfe-card nfe-card-table">
        <div class="nfe-card-header nfe-card-header-with-actions">
          <div>
            <h2>Fila de chaves</h2>
            <p class="nfe-card-subtitle">
              Acompanhe o status de cada chave enviada para consulta.
            </p>
          </div>
          <div class="nfe-table-actions">
            <button id="btnClearPending" class="btn btn-ghost-danger">
              Limpar pendentes
            </button>
            <button id="btnClearDone" class="btn btn-ghost-danger">
              Limpar concluídos
            </button>
            <button id="btnClearErrors" class="btn btn-ghost-danger">
              Limpar erros
            </button>
          </div>
        </div>

        <div class="nfe-table-wrapper">
          <table class="nfe-table">
            <thead>
              <tr>
                <th>Chave</th>
                <th>Status</th>
                <th>Mensagem</th>
                <th>Atualizado em</th>
              </tr>
            </thead>
            <tbody id="jobsTableBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Aviso de captcha -->
      <section class="nfe-card nfe-card-warning" id="captchaNotification" style="display:none;">
        <div class="nfe-warning-icon">⚠️</div>
        <div>
          <strong>Atenção:</strong> existe(m) chave(s) aguardando validação de captcha.
          <p>Verifique a janela do Portal Nacional e conclua a validação.</p>
        </div>
      </section>
    </main>
  </div>

  <script src="/js/sidebar.js"></script>
  <script src="/js/nfe.js"></script>

</body>

</html>